{"ast":null,"code":"import _asyncToGenerator from \"/Users/erikmattheis/Dropbox/articl/heroku/src/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"/Users/erikmattheis/Dropbox/articl/heroku/src/frontend/node_modules/core-js/modules/es.array.iterator.js\";\nimport \"/Users/erikmattheis/Dropbox/articl/heroku/src/frontend/node_modules/core-js/modules/es.promise.js\";\nimport \"/Users/erikmattheis/Dropbox/articl/heroku/src/frontend/node_modules/core-js/modules/es.object.assign.js\";\nimport \"/Users/erikmattheis/Dropbox/articl/heroku/src/frontend/node_modules/core-js/modules/es.promise.finally.js\";\n\nvar _this = this;\n\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.search.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport { createApp } from 'vue';\nimport axios from 'axios';\nimport { getAccessTokenValue, getRefreshTokenValue, setTokensInLocalStorage, setTokensInVuex, convertStringDatesToMS } from '@/services/tokenService';\nimport router from './router';\nimport store from './store/index';\nimport App from './App.vue';\nvar app = createApp(App);\n\nfunction getAccessTokenFromRefreshToken() {\n  var refreshToken = getRefreshTokenValue();\n  return app.config.globalProperties.$http({\n    method: 'POST',\n    url: '/auth/refresh-tokens',\n    data: {\n      refreshToken: refreshToken\n    }\n  });\n}\n\nvar base_url = window.location.search('localhost') ? 'http://localhost:5000/v1' : 'https://api.articl.net/v1';\napp.config.globalProperties.$http = axios.create({\n  baseURL: process.env.VUE_APP_BASE_URL\n});\napp.config.globalProperties.$http.interceptors.request.use(function (request) {\n  var req = request;\n  var accessTokenValue = getAccessTokenValue(); // console.log('should always trace', accessTokenValue);\n\n  if (accessTokenValue) {\n    req.headers.Authorization = \"Bearer \".concat(accessTokenValue);\n  }\n\n  return Promise.resolve(req);\n}, function (error) {\n  return Promise.reject(error);\n});\n\nfunction handleLoginSuccess(serverResult) {\n  if (serverResult.code > 309) {\n    this.$store.dispatch('setError', serverResult);\n    return;\n  }\n\n  var result = convertStringDatesToMS(serverResult);\n  setTokensInLocalStorage(result.data.tokens);\n  setTokensInVuex(result.data.tokens);\n\n  if (this.$route.query.redirect && this.$route.query.redirect !== '/login') {\n    this.$router.push({\n      path: this.$route.query.redirect\n    });\n  } else {\n    this.$router.push({\n      name: 'HomePage'\n    });\n  }\n}\n\nvar handleResponseError = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(error) {\n    var _error$response;\n\n    var result;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!(error !== null && error !== void 0 && (_error$response = error.response) !== null && _error$response !== void 0 && _error$response.status)) {\n              _context.next = 24;\n              break;\n            }\n\n            _context.t0 = error.response.status;\n            _context.next = _context.t0 === 400 ? 4 : _context.t0 === 401 ? 5 : _context.t0 === 403 ? 9 : _context.t0 === 502 ? 20 : 22;\n            break;\n\n          case 4:\n            return _context.abrupt(\"break\", 24);\n\n          case 5:\n            if (!(router.currentRoute.value.name === 'login')) {\n              _context.next = 7;\n              break;\n            }\n\n            return _context.abrupt(\"return\", Promise.reject(error.response.data));\n\n          case 7:\n            router.push({\n              name: 'login',\n              query: {\n                redirect: window.location.pathname + window.location.search\n              }\n            });\n            return _context.abrupt(\"break\", 24);\n\n          case 9:\n            _context.prev = 9;\n            _context.next = 12;\n            return getAccessTokenFromRefreshToken();\n\n          case 12:\n            result = _context.sent;\n            handleLoginSuccess(result);\n            _context.next = 19;\n            break;\n\n          case 16:\n            _context.prev = 16;\n            _context.t1 = _context[\"catch\"](9);\n            return _context.abrupt(\"return\", Promise.reject(_context.t1.response.data));\n\n          case 19:\n            return _context.abrupt(\"break\", 24);\n\n          case 20:\n            _this.$store.dispatch('setError', error);\n\n            return _context.abrupt(\"break\", 24);\n\n          case 22:\n            // maybe like this\n            // console.log('err', error);\n            store.dispatch('setError', error);\n            return _context.abrupt(\"break\", 24);\n\n          case 24:\n            return _context.abrupt(\"return\", Promise.reject(error));\n\n          case 25:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[9, 16]]);\n  }));\n\n  return function handleResponseError(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\napp.config.globalProperties.$http.interceptors.response.use(function (response) {\n  if (response.status === 200 || response.status === 201) {\n    return Promise.resolve(response);\n  }\n\n  return Promise.reject(response);\n}, handleResponseError);\napp.use(router);\napp.use(store);\napp.mount('#app');","map":{"version":3,"sources":["/Users/erikmattheis/Dropbox/articl/heroku/src/frontend/src/main.js"],"names":["createApp","axios","getAccessTokenValue","getRefreshTokenValue","setTokensInLocalStorage","setTokensInVuex","convertStringDatesToMS","router","store","App","app","getAccessTokenFromRefreshToken","refreshToken","config","globalProperties","$http","method","url","data","base_url","window","location","search","create","baseURL","process","env","VUE_APP_BASE_URL","interceptors","request","use","req","accessTokenValue","headers","Authorization","Promise","resolve","error","reject","handleLoginSuccess","serverResult","code","$store","dispatch","result","tokens","$route","query","redirect","$router","push","path","name","handleResponseError","response","status","currentRoute","value","pathname","mount"],"mappings":"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","sourcesContent":["import { createApp } from 'vue';\nimport axios from 'axios';\nimport {\n  getAccessTokenValue, getRefreshTokenValue, setTokensInLocalStorage, setTokensInVuex,\n  convertStringDatesToMS,\n} from '@/services/tokenService';\nimport router from './router';\nimport store from './store/index';\nimport App from './App.vue';\n\nconst app = createApp(App);\n\nfunction getAccessTokenFromRefreshToken() {\n  const refreshToken = getRefreshTokenValue();\n  return app.config.globalProperties.$http({\n    method: 'POST',\n    url: '/auth/refresh-tokens',\n    data: {\n      refreshToken,\n    },\n  });\n}\n\nconst base_url = window.location.search('localhost') ? 'http://localhost:5000/v1' : 'https://api.articl.net/v1';\napp.config.globalProperties.$http = axios.create({\n  baseURL: process.env.VUE_APP_BASE_URL,\n});\n\napp.config.globalProperties.$http.interceptors.request.use(\n  (request) => {\n    const req = request;\n\n    const accessTokenValue = getAccessTokenValue();\n    // console.log('should always trace', accessTokenValue);\n    if (accessTokenValue) {\n      req.headers.Authorization = `Bearer ${accessTokenValue}`;\n    }\n    return Promise.resolve(req);\n  },\n\n  (error) => Promise.reject(error),\n);\n\nfunction handleLoginSuccess(serverResult) {\n  if (serverResult.code > 309) {\n    this.$store.dispatch('setError', serverResult);\n    return;\n  }\n  const result = convertStringDatesToMS(serverResult);\n  setTokensInLocalStorage(result.data.tokens);\n  setTokensInVuex(result.data.tokens);\n  if (\n    this.$route.query.redirect &&\nthis.$route.query.redirect !== '/login'\n  ) {\n    this.$router.push({\n      path: this.$route.query.redirect,\n    });\n  } else {\n    this.$router.push({\n      name: 'HomePage',\n    });\n  }\n}\n\nconst handleResponseError = async (error) => {\n  if (error?.response?.status) {\n    switch (error.response.status) {\n      case 400:\n        break;\n      case 401:\n        if (router.currentRoute.value.name === 'login') {\n          return Promise.reject(error.response.data);\n        }\n        router.push({\n          name: 'login',\n          query: { redirect: window.location.pathname + window.location.search },\n        });\n        break;\n      case 403: {\n        try {\n          const result = await getAccessTokenFromRefreshToken();\n          handleLoginSuccess(result);\n        } catch (err) {\n          return Promise.reject(err.response.data);\n        }\n\n        /*\n        router.push({\n          name: 'login',\n          query: { redirect: window.location.pathname + window.location.search },\n        });\n        */\n        break;\n      }\n      case 502:\n        this.$store.dispatch('setError', error);\n        break;\n      default:\n        // maybe like this\n        // console.log('err', error);\n        store.dispatch('setError', error);\n        break;\n    }\n  }\n  return Promise.reject(error);\n};\n\napp.config.globalProperties.$http.interceptors.response.use(\n  (response) => {\n    if (response.status === 200 || response.status === 201) {\n      return Promise.resolve(response);\n    }\n    return Promise.reject(response);\n  },\n  handleResponseError,\n);\n\napp.use(router);\napp.use(store);\n\napp.mount('#app');\n"]},"metadata":{},"sourceType":"module"}